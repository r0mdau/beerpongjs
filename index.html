<!DOCTYPE html>
<html>
<head>
    <title>beerpongJs</title>
    <meta charset="utf-8"/>
    <script src="libs/three.js"></script>
    <script src="libs/physi.js"></script>
    <script src="libs/stats.min.js"></script>
    <script src="libs/OrbitControls.js"></script>
    <script src="libs/ColladaLoader.js"></script>
    <script src="libs/jquery-1.11.1.min.js"></script>
    <script src="assets/js/whenMyKeyIsPressed.js"></script>
    <script src="assets/js/scene.js"></script>
    <script src="assets/js/game.js"></script>
    <script src="assets/js/myscreen.js"></script>
    <script src="assets/js/ball.js"></script>
    <link href='http://fonts.googleapis.com/css?family=Ubuntu' rel='stylesheet' type='text/css'>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>
<canvas id="myCanvas" width="350" height="350" style="display: none"></canvas>
<div id="control" style="position: absolute">
    <p>Direction :</p>
    <input type="range" id="direction" value="0" min="-7" max="7"/>

    <p>Puissance :</p>
    <input type="range" id="puissance" value="35" min="20" max="50"/>
    <br/>
</div>

<div id="commande" style="position: absolute">
    <h2>Commandes</h2>
    <span>Lancer la balle : <b>Entrée</b></span><br/>
    <span>Ouvrir le chat : touche <b>C</b></span><br/><br/>
    <span id="missingPlayer" style="display: none;color:red">Il manque le second joueur</span><br>

    <h3 id="message" style="display: none; color:green">A vous de jouer !</h3>
    <span>Si ce n'est pas à vous de jouer, c'est à l'autre ...</span>
</div>

<div id="score" style="position: absolute">
    <p>Cups restantes : <span id="nbcups">10</span></p>

    <p>Nombre de tirs : <span id="nbtir">0</span></p>
</div>

<script src="http://webservice.ovh/socket.io/socket.io.js"></script>
<script>
    'use strict';

    var game, myScreen;
    var renderer;
    var scene;
    var camera, cameraControl;
    var cup, ball;
    var socket;
    var canPlay = false;

    $(document).ready(function () {
        socket = io('http://webservice.ovh');
        myScreen = new MyScreen();
        scene = new Scene();
        scene.create();
        game = new Game();

        socket.on('canPlay', function (bool) {
            canPlay = eval(bool);
        });

        socket.on('nickname', function (nick) {
            $('#commande').append($('<p>').text(
                    'Votre pseudo : ' + nick
            ))
        });

        socket.on('oNick', function (nick) {
            $('#commande').append($('<p>').text(
                    'Adversaire : ' + nick
            ));
        });

        socket.on('players', function (nb) {
            if (parseInt(nb) == 1) {
                $('#message').show();
            }
            if (parseInt(nb) < 2) {
                $('#missingPlayer').show();
            } else {
                $('#missingPlayer').hide();
            }
        });

        socket.on('velocity', function (velocity) {
            ball.initWithPos({x: 0, y: 15, z: -44});
            velocity = JSON.parse(velocity);
            ball.launch({x: -velocity.x, y: velocity.y, z: -velocity.z});
            game.unPause();
        });

        myScreen.initGameMenu();
        myScreen.addStatsObject();
        document.body.appendChild(renderer.domElement);
        render();
    });

    function render() {
        game.play();

        myScreen.updateStats();
        cameraControl.update();
        requestAnimationFrame(render);
        renderer.render(scene, camera);
    }

    $(document).keypress(function (e) {
        if (!ball.isLaunched) {
            playWhenMyKeyIsPressed(e);
        }
        doThingsWhenMyKeyIsPressed(e);
    });

    $(window).resize(function () {
        myScreen.initGameMenu();
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });
</script>
</body>
</html>